{% extends "base.html" %}
{% block content %}
<div class="container">
  <h1 class="mb-4">Demo: Add & Retrieve</h1>

  <div class="row g-4">

    <div class="col-lg-5">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title">Add Student</h5>
          <form action="/student" method="POST">
     
            <div class="mb-2">
              <label class="form-label">Student ID (int)</label>
              <input name="student_id" type="number" class="form-control" required />
            </div>
            <div class="mb-2">
              <label class="form-label">First Name</label>
              <input name="first_name" type="text" class="form-control" required />
            </div>
            <div class="mb-2">
              <label class="form-label">Last Name</label>
              <input name="last_name" type="text" class="form-control" required />
            </div>
            <div class="mb-2">
              <label class="form-label">Email</label>
              <input name="email" type="email" class="form-control" required />
            </div>
            <div class="mb-2">
              <label class="form-label">Grad Year (int, optional)</label>
              <input name="grad_year" type="number" class="form-control" />
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input name="password" type="password" class="form-control" required />
            </div>
            <button class="btn btn-primary w-100" type="submit">Add Student</button>
          </form>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Add Course</h5>
          <form action="/course" method="POST">

            <div class="mb-2">
              <label class="form-label">Course ID (int)</label>
              <input name="course_id" type="number" class="form-control" required />
            </div>
            <div class="mb-2">
              <label class="form-label">Title</label>
              <input name="title" type="text" class="form-control" required />
            </div>
            <div class="mb-2">
              <label class="form-label">Year</label>
              <input name="year" type="number" class="form-control" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Section (optional)</label>
              <input name="section" type="text" class="form-control" />
            </div>
            <button class="btn btn-secondary w-100" type="submit">Add Course</button>
          </form>
        </div>
      </div>
    </div>


    <div class="col-lg-7">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title mb-0">Students (from /get/students)</h5>
            <button id="refreshStudents" class="btn btn-outline-primary btn-sm">Refresh</button>
          </div>
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th>ID</th><th>First</th><th>Last</th><th>Email</th><th>Grad Year</th>
                </tr>
              </thead>
              <tbody id="studentsBody">
                <tr><td colspan="5" class="text-muted">Loading…</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title mb-0">Courses (from /get/courses)</h5>
            <button id="refreshCourses" class="btn btn-outline-secondary btn-sm">Refresh</button>
          </div>
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th>ID</th><th>Title</th><th>Year</th><th>Section</th>
                </tr>
              </thead>
              <tbody id="coursesBody">
                <tr><td colspan="4" class="text-muted">Loading…</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
async function loadStudents() {
  const tbody = document.getElementById('studentsBody');
  tbody.innerHTML = '<tr><td colspan="5" class="text-muted">Loading…</td></tr>';
  try {
    const res = await fetch('/get/students');
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error('Unexpected response');
    tbody.innerHTML = data.map(r => `
      <tr>
        <td>${r.student_id ?? ''}</td>
        <td>${r.first_name ?? ''}</td>
        <td>${r.last_name ?? ''}</td>
        <td>${r.email ?? ''}</td>
        <td>${r.grad_year ?? ''}</td>
      </tr>
    `).join('') || '<tr><td colspan="5" class="text-muted">No data</td></tr>';
  } catch (e) {
    tbody.innerHTML = `<tr><td colspan="5" class="text-danger">Error: ${e.message}</td></tr>`;
  }
}

async function loadCourses() {
  const tbody = document.getElementById('coursesBody');
  tbody.innerHTML = '<tr><td colspan="4" class="text-muted">Loading…</td></tr>';
  try {
    const res = await fetch('/get/courses');
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error('Unexpected response');
    tbody.innerHTML = data.map(r => `
      <tr>
        <td>${r.course_id ?? ''}</td>
        <td>${r.title ?? ''}</td>
        <td>${r.year ?? ''}</td>
        <td>${r.section ?? ''}</td>
      </tr>
    `).join('') || '<tr><td colspan="4" class="text-muted">No data</td></tr>';
  } catch (e) {
    tbody.innerHTML = `<tr><td colspan="4" class="text-danger">Error: ${e.message}</td></tr>`;
  }
}

document.getElementById('refreshStudents').addEventListener('click', loadStudents);
document.getElementById('refreshCourses').addEventListener('click', loadCourses);


loadStudents();
loadCourses();
</script>
{% endblock %}
